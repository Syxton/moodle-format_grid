{"version":3,"file":"thegrid.min.js","sources":["../src/thegrid.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS module for the grid.\n *\n * @module      format_grid/thegrid\n * @copyright   &copy; 2023-onwards G J Barnard.\n * @author      G J Barnard - gjbarnard at gmail dot com and {@link http://moodle.org/user/profile.php?id=442195}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as CourseEvents from 'core_course/events';\nimport jQuery from 'jquery';\nimport log from 'core/log';\n\n/**\n * Whether the event listener has already been registered for this module.\n *\n * @type {boolean}\n */\nlet registered = false;\n\n/**\n * If the manualCompletionToggled event has fired.\n *\n * @type {boolean}\n */\nlet mctFired = false;\n\n/**\n * Function to intialise and register event listeners for this module.\n *\n * @param {array} sectionnumbers Show completion is on.\n * @param {boolean} showcompletion Show completion is on.\n */\nexport const init = (sectionnumbers, showcompletion) => {\n    log.debug('Grid thegrid JS init');\n    if (registered) {\n        log.debug('Grid thegrid JS init already registered');\n        return;\n    } else {\n        log.debug('Grid thegrid sectionnumbers ' + sectionnumbers);\n    }\n    // Listen for toggled manual completion states of activities.\n    document.addEventListener(CourseEvents.manualCompletionToggled, () => {\n        mctFired = true;\n    });\n    registered = true;\n\n    // Grid current section.\n    var currentsection = -1;\n    var endsection = sectionnumbers.length - 1;\n\n    // Modal.\n    var currentmodalsection = null;\n    var modalshown = false;\n\n    jQuery('#gridPopup').on('show.bs.modal', function(event) {\n        var section = currentmodalsection;\n        if (section === null) {\n            var trigger = jQuery(event.relatedTarget);\n            section = trigger.data('section');\n        }\n        currentsection = section - 1;\n\n        var gml = jQuery('#gridPopupLabel');\n        var triggersectionname = jQuery('#gridpopupsection-' + section).data('sectiontitle');\n        gml.text(triggersectionname);\n\n        var modal = jQuery(this);\n        modal.find('#gridpopupsection-' + section).addClass('active');\n\n        jQuery('#gridPopupCarousel').on('slid.bs.carousel', function() {\n            var sno = jQuery('.gridcarousel-item.active').data('sectiontitle');\n            gml.text(sno);\n        });\n    });\n\n    jQuery('#gridPopup').on('hidden.bs.modal', function() {\n        if (currentmodalsection !== null) {\n            currentmodalsection = null;\n        }\n        jQuery('.gridcarousel-item').removeClass('active');\n        if (showcompletion && mctFired) {\n            mctFired = false;\n            window.location.reload();\n        }\n        modalshown = false;\n    });\n\n    jQuery(\".grid-section .grid-modal\").on('keydown', function (event) {\n        if ((event.which == 13) || (event.which == 27)) {\n            event.preventDefault();\n            var trigger = jQuery(event.currentTarget);\n            currentmodalsection = trigger.data('section');\n            modalshown = true;\n            jQuery('#gridPopup').modal('show');\n        }\n    });\n\n    jQuery(\"#gridPopup\").on('keydown', function(event) {\n        if (event.which == 37) {\n            // Left.\n            event.preventDefault();\n            jQuery('#gridPopupCarouselLeft').trigger('click');\n        }\n        else if (event.which == 39) {\n            // Right.\n            event.preventDefault();\n            jQuery('#gridPopupCarouselRight').trigger('click');\n        }\n    });\n\n    jQuery(document).on('keydown', function (event) {\n        if (event.which == 37) {\n            // Left.\n            event.preventDefault();\n            if ((currentsection == -1) || (currentsection == 0)) {\n                if (currentsection == 0) {\n                    jQuery('#section-' + sectionnumbers[currentsection]).removeClass('grid-current-section');\n                }\n                currentsection = endsection;\n                jQuery('#section-' + sectionnumbers[currentsection]).addClass('grid-current-section');\n            } else {\n                jQuery('#section-' + sectionnumbers[currentsection]).removeClass('grid-current-section');\n                currentsection = currentsection - 1;\n                jQuery('#section-' + sectionnumbers[currentsection]).addClass('grid-current-section');\n            }\n            log.debug(\"Left: \" + sectionnumbers[currentsection]);\n        } else if (event.which == 39) {\n            // Right.\n            event.preventDefault();\n            if ((currentsection == -1) || (currentsection == endsection)) {\n                if (currentsection == endsection) {\n                    jQuery('#section-' + sectionnumbers[currentsection]).removeClass('grid-current-section');\n                }\n                currentsection = 0;\n                jQuery('#section-' + sectionnumbers[currentsection]).addClass('grid-current-section');\n            } else {\n                jQuery('#section-' + sectionnumbers[currentsection]).removeClass('grid-current-section');\n                currentsection = currentsection + 1;\n                jQuery('#section-' + sectionnumbers[currentsection]).addClass('grid-current-section');\n            }\n            log.debug(\"Right: \" + sectionnumbers[currentsection]);\n        } else if ((event.which == 13) || (event.which == 27)) {\n            event.preventDefault();\n            //var trigger = jQuery(event.currentTarget);\n            if ((currentsection !== -1) && (!modalshown)) {\n                currentmodalsection = sectionnumbers[currentsection];\n            }\n            modalshown = true;\n            jQuery('#gridPopup').modal('show');\n        }\n    });\n};\n"],"names":["registered","mctFired","sectionnumbers","showcompletion","debug","document","addEventListener","CourseEvents","manualCompletionToggled","currentsection","endsection","length","currentmodalsection","modalshown","on","event","section","relatedTarget","data","gml","triggersectionname","text","this","find","addClass","sno","removeClass","window","location","reload","which","preventDefault","trigger","currentTarget","modal"],"mappings":";;;;;;;;kGAiCIA,YAAa,EAObC,UAAW,gBAQK,CAACC,eAAgBC,kCAC7BC,MAAM,wBACNJ,wBACII,MAAM,6DAGNA,MAAM,+BAAiCF,gBAG/CG,SAASC,iBAAiBC,aAAaC,yBAAyB,KAC5DP,UAAW,KAEfD,YAAa,MAGTS,gBAAkB,EAClBC,WAAaR,eAAeS,OAAS,EAGrCC,oBAAsB,KACtBC,YAAa,sBAEV,cAAcC,GAAG,iBAAiB,SAASC,WAC1CC,QAAUJ,oBACE,OAAZI,UAEAA,SADc,mBAAOD,MAAME,eACTC,KAAK,YAE3BT,eAAiBO,QAAU,MAEvBG,KAAM,mBAAO,mBACbC,oBAAqB,mBAAO,qBAAuBJ,SAASE,KAAK,gBACrEC,IAAIE,KAAKD,qBAEG,mBAAOE,MACbC,KAAK,qBAAuBP,SAASQ,SAAS,8BAE7C,sBAAsBV,GAAG,oBAAoB,eAC5CW,KAAM,mBAAO,6BAA6BP,KAAK,gBACnDC,IAAIE,KAAKI,+BAIV,cAAcX,GAAG,mBAAmB,WACX,OAAxBF,sBACAA,oBAAsB,0BAEnB,sBAAsBc,YAAY,UACrCvB,gBAAkBF,WAClBA,UAAW,EACX0B,OAAOC,SAASC,UAEpBhB,YAAa,yBAGV,6BAA6BC,GAAG,WAAW,SAAUC,UACpC,IAAfA,MAAMe,OAAgC,IAAff,MAAMe,MAAc,CAC5Cf,MAAMgB,qBACFC,SAAU,mBAAOjB,MAAMkB,eAC3BrB,oBAAsBoB,QAAQd,KAAK,WACnCL,YAAa,sBACN,cAAcqB,MAAM,gCAI5B,cAAcpB,GAAG,WAAW,SAASC,OACrB,IAAfA,MAAMe,OAENf,MAAMgB,qCACC,0BAA0BC,QAAQ,UAErB,IAAfjB,MAAMe,QAEXf,MAAMgB,qCACC,2BAA2BC,QAAQ,iCAI3C3B,UAAUS,GAAG,WAAW,SAAUC,OAClB,IAAfA,MAAMe,OAENf,MAAMgB,kBACkB,GAAnBtB,gBAA4C,GAAlBA,gBACL,GAAlBA,oCACO,YAAcP,eAAeO,iBAAiBiB,YAAY,wBAErEjB,eAAiBC,+BACV,YAAcR,eAAeO,iBAAiBe,SAAS,8CAEvD,YAActB,eAAeO,iBAAiBiB,YAAY,wBACjEjB,gBAAkC,sBAC3B,YAAcP,eAAeO,iBAAiBe,SAAS,sCAE9DpB,MAAM,SAAWF,eAAeO,kBACd,IAAfM,MAAMe,OAEbf,MAAMgB,kBACkB,GAAnBtB,gBAA0BA,gBAAkBC,YACzCD,gBAAkBC,gCACX,YAAcR,eAAeO,iBAAiBiB,YAAY,wBAErEjB,eAAiB,sBACV,YAAcP,eAAeO,iBAAiBe,SAAS,8CAEvD,YAActB,eAAeO,iBAAiBiB,YAAY,wBACjEjB,gBAAkC,sBAC3B,YAAcP,eAAeO,iBAAiBe,SAAS,sCAE9DpB,MAAM,UAAYF,eAAeO,kBACd,IAAfM,MAAMe,OAAgC,IAAff,MAAMe,QACrCf,MAAMgB,kBAEmB,IAApBtB,gBAA4BI,aAC7BD,oBAAsBV,eAAeO,iBAEzCI,YAAa,sBACN,cAAcqB,MAAM"}